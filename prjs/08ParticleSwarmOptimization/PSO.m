% ??????
clear all;
% ??
close all;
% ??
clc;

% ????
f = @(x, y) 3 * cos(x * y) + x + y * y;

% ??????
x = -4:0.02:4;
y = -4:0.02:4;
N = size(x, 2);

% ?????
z = zeros(N);
for i = 1:N
    for j = 1:N
        z(i, j) = f(x(i), y(j));
    end
end

% ??????
mesh(x, y, z)
xlabel('x')
ylabel('y')

% ?????????
N = 200;     % ??????
D = 2;       % ????
T = 100;     % ??????
c1 = 1.4;    % ???? 1
c2 = 1.5;    % ???? 2
Wmax = 0.7;  % ???????
Wmin = 0.3;  % ???????
Xmax = 4;    % ?????
Xmin = -4;   % ?????
Vmax = 1;    % ?????
Vmin = -1;   % ?????

% ????????????????
x = rand(N, D) * (Xmax - Xmin) + Xmin;
v = rand(N, D) * (Vmax - Vmin) + Vmin;

% ?????????????
p = x;
pbest = ones(N, 1);
for i = 1:N
    pbest(i) = f(x(i, 1), x(i, 2));
end

% ?????????????
g = ones(1, D);
gbest = inf;
for i = 1:N
    if(pbest(i) < gbest)
        g = p(i, :);
        gbest = pbest(i);
    end
end

% ????
gb = ones(1, T);
for i = 1:T
    for j = 1:N
        % ????????????
        if (f(x(j, 1), x(j, 2)) < pbest(j))
            p(j, :) = x(j, :);
            pbest(j) = f(x(j, 1), x(j, 2));
        end
        % ????????????
        if(pbest(j) < gbest)
            g = p(j, :);
            gbest = pbest(j);
        end
        % ?????????
        w = Wmax - (Wmax - Wmin) * i / T;
        % ????????
        v(j, :) = w * v(j, :) + c1 * rand * (p(j, :) - x(j, :)) ...
                  + c2 * rand * (g - x(j, :));
        x(j, :) = x(j, :) + v(j, :);
        % ??????
        for ii = 1:D
            if (v(j, ii) > Vmax) || (v(j, ii) < Vmin)
                v(j, ii) = rand * (Vmax - Vmin) + Vmin;
            end
            if (x(j, ii) > Xmax) || (x(j, ii) < Xmin)
                x(j, ii) = rand * (Xmax - Xmin) + Xmin;
            end
        end
    end
    % ?????????
    gb(i) = gbest;
end

% ????
disp('Best individual:');
disp(g);
disp('Optimal value');
disp(gb(end));

% ?????????
figure;
plot(gb);
xlabel('IterNum');
ylabel('FitnessValue');
title('FEC');
